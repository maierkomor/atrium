diff --git a/components/lwip/component.mk b/components/lwip/component.mk
index dca3784775..2806eba928 100644
--- a/components/lwip/component.mk
+++ b/components/lwip/component.mk
@@ -5,7 +5,6 @@ COMPONENT_SUBMODULES += lwip
 
 COMPONENT_ADD_INCLUDEDIRS := \
 	include/apps \
-	include/apps/sntp \
 	lwip/src/include \
 	port/esp32/include \
 	port/esp32/include/arch \
@@ -15,9 +14,7 @@ COMPONENT_ADD_INCLUDEDIRS := \
 COMPONENT_SRCDIRS := \
 	apps/dhcpserver \
 	apps/ping \
-	apps/sntp \
 	lwip/src/api \
-	lwip/src/apps/sntp \
 	lwip/src/core \
 	lwip/src/core/ipv4 \
 	lwip/src/core/ipv6 \
diff --git a/components/lwip/port/esp32/freertos/sys_arch.c b/components/lwip/port/esp32/freertos/sys_arch.c
index 1f98eee71a..5c4c7fecc5 100644
--- a/components/lwip/port/esp32/freertos/sys_arch.c
+++ b/components/lwip/port/esp32/freertos/sys_arch.c
@@ -72,10 +72,13 @@ sys_mutex_new(sys_mutex_t *pxMutex)
 
 /** Lock a mutex
  * @param mutex the mutex to lock */
+extern void abort_on_mutex(sys_mutex_t,const char *);
 void ESP_IRAM_ATTR
 sys_mutex_lock(sys_mutex_t *pxMutex)
 {
-  while (xSemaphoreTake(*pxMutex, portMAX_DELAY) != pdPASS);
+	if (pdFALSE == xSemaphoreTake(*pxMutex, 10000))
+		abort_on_mutex(*pxMutex,"<system>");
 }
 
 err_t
